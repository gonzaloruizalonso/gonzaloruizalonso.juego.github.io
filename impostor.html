<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Impostor</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent-red: #ef4444;
            --accent-green: #10b981;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Títulos */
        .title-gradient {
            background: linear-gradient(to right, #ef4444, #a855f7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
            text-transform: uppercase;
            font-style: italic;
        }

        /* Inputs */
        .player-input {
            background-color: var(--card-bg);
            border: 1px solid #334155;
            color: #ffffff !important; /* Forzar blanco puro */
            font-weight: 500;
        }
        
        /* Color del placeholder (texto de ayuda) más claro */
        .player-input::placeholder {
            color: #94a3b8 !important;
            opacity: 1;
        }

        .player-input:focus {
            background-color: var(--card-bg);
            color: #ffffff !important;
            border-color: var(--accent-red);
            box-shadow: none;
        }

        /* Cartas */
        .role-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            border: 2px solid #334155;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .role-card:active {
            transform: scale(0.98);
        }

        .role-card.impostor {
            background-color: #450a0a;
            border-color: var(--accent-red);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.2);
        }

        .role-card.civilian {
            background-color: #064e3b;
            border-color: var(--accent-green);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
        }

        /* Botones */
        .btn-start {
            background: linear-gradient(to right, #dc2626, #ef4444);
            border: none;
            padding: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
        }
        .btn-start:active {
            transform: scale(0.98);
        }

        /* Utilidades */
        .screen {
            display: none; /* Ocultar todo por defecto */
            flex: 1;
            padding: 20px;
            animation: fadeIn 0.4s ease-in-out;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .word-reveal {
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- PANTALLA 1: CONFIGURACIÓN -->
        <div id="setupScreen" class="screen active">
            <div class="text-center mt-3 mb-4">
                <h1 class="display-4 title-gradient">El Impostor</h1>
                <p class="text-secondary small">Descubre quién miente. Mínimo 3 jugadores.</p>
            </div>

            <div id="playersContainer" class="flex-grow-1 overflow-auto mb-3">
                <!-- Los inputs se generan aquí -->
            </div>

            <button class="btn btn-outline-secondary w-100 mb-3 dashed-border" onclick="addPlayerInput()">
                <i class="fas fa-plus"></i> Añadir Jugador
            </button>

            <div class="mt-auto">
                <button class="btn btn-primary w-100 btn-start text-white rounded-4" onclick="startGame()">
                    <i class="fas fa-play me-2"></i> EMPEZAR PARTIDA
                </button>
                <div class="text-center mt-2">
                    <span id="playerCountLabel" class="text-muted small">0 jugadores listos</span>
                </div>
            </div>
        </div>

        <!-- PANTALLA 2: DISTRIBUCIÓN -->
        <div id="gameScreen" class="screen justify-content-center">
            
            <div class="text-center mb-4">
                <span class="badge bg-secondary rounded-pill mb-2">Turno <span id="currentTurnLabel">1</span></span>
                <h2 class="fw-bold">Pásale el móvil a</h2>
                <h1 id="playerNameDisplay" class="title-gradient display-5 mt-2">NOMBRE</h1>
            </div>

            <!-- TARJETA OCULTA (TAPA) -->
            <div id="hiddenCard" class="role-card" onclick="revealCard()">
                <div class="bg-dark p-4 rounded-circle mb-3">
                    <i class="fas fa-eye fa-3x text-secondary"></i>
                </div>
                <h4 class="text-light fw-bold">Toca para ver tu rol</h4>
                <p class="text-secondary small text-center px-4">Asegúrate de que nadie más esté mirando</p>
            </div>

            <!-- TARJETA REVELADA (ROL) -->
            <div id="revealedCard" class="d-none w-100">
                <div id="roleContent" class="role-card mb-4">
                    <!-- Contenido dinámico (Impostor o Palabra) -->
                </div>
                
                <button class="btn btn-light w-100 py-3 fw-bold rounded-4 shadow" onclick="nextPlayer()">
                    <i class="fas fa-eye-slash me-2"></i> Ocultar y Pasar
                </button>
            </div>

        </div>

        <!-- PANTALLA 3: RESULTADO -->
        <div id="resultScreen" class="screen justify-content-center text-center">
            
            <div class="card bg-dark border-secondary mb-4 shadow-lg">
                <div class="card-body p-5">
                    <p class="text-secondary text-uppercase fw-bold small ls-2">Empieza hablando</p>
                    <h1 id="starterName" class="display-3 fw-black text-warning mb-0" style="text-shadow: 0 0 20px rgba(255,193,7,0.3);">NOMBRE</h1>
                </div>
            </div>

            <div class="bg-opacity-10 bg-white p-4 rounded-3 text-start mb-5 border border-secondary">
                <h5 class="text-light mb-3"><i class="fas fa-info-circle me-2"></i>Instrucciones:</h5>
                <ul class="text-secondary small mb-0 ps-3">
                    <li class="mb-2">Decid una palabra por turnos.</li>
                    <li class="mb-2">El <span class="text-danger fw-bold">Impostor</span> no sabe la palabra y debe disimular.</li>
                    <li>Votad quién creéis que es el mentiroso.</li>
                </ul>
            </div>

            <div class="mt-auto gap-3 d-grid">
                <button class="btn btn-danger btn-lg py-3 fw-bold rounded-4" onclick="playAgain()">
                    <i class="fas fa-redo me-2"></i> Otra Ronda
                </button>
                <button class="btn btn-outline-secondary py-2 rounded-4" onclick="resetToSetup()">
                    Cambiar Jugadores
                </button>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- BASE DE DATOS DE PALABRAS ---
        const WORD_DATABASE = [
            "Rosalía", "Ibai Llanos", "Fernando Alonso", "Rafa Nadal", "Belén Esteban", 
            "El Rey Felipe VI", "Antonio Banderas", "Penélope Cruz", "Bad Bunny", "Messi", 
            "Shakira", "Pikachu", "Harry Potter", "Doraemon", "Spiderman",
            "Tortilla de Patata", "Paella", "Gazpacho", "Jamón Ibérico", "Croquetas", 
            "Churros", "Sushi", "Pizza", "Hamburguesa", "Kebab", "Cerveza", "Vino Tinto",
            "Mercadona", "La Playa", "Discoteca", "Hospital", "Cementerio", "Cárcel", 
            "Aeropuerto", "Gimnasio", "IKEA", "Colegio", "Cuarto de Baño", "La Luna",
            "Papel Higiénico", "Satisfyer", "iPhone", "Tanga", "Calcetines", 
            "Cepillo de Dientes", "Mando de la TV", "Sartén", "Microondas", "Espejo",
            "Boda", "Divorcio", "Resaca", "Siesta", "Cotilleo", "Infidelidad"
        ];

        // --- ESTADO DEL JUEGO ---
        let players = ['', '', '']; // CAMBIO: Inicial 3 huecos vacíos en lugar de 4
        let usedWords = [];
        let secretWord = "";
        let impostorIndex = -1;
        let currentPlayerIndex = 0;
        let activePlayersList = [];

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderPlayerInputs();
        });

        // --- GESTIÓN DE JUGADORES (SETUP) ---
        function renderPlayerInputs() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = ''; // Limpiar

            players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'input-group mb-2';
                
                // Botón de eliminar solo si hay más de 3
                const deleteBtn = players.length > 3 
                    ? `<button class="btn btn-outline-secondary border-start-0" type="button" onclick="removePlayer(${index})"><i class="fas fa-times"></i></button>`
                    : '';

                div.innerHTML = `
                    <span class="input-group-text bg-dark border-secondary text-secondary"><i class="fas fa-user"></i></span>
                    <input type="text" class="form-control player-input shadow-none" placeholder="Jugador ${index + 1}" value="${player}" oninput="updatePlayerName(${index}, this.value)">
                    ${deleteBtn}
                `;
                container.appendChild(div);
            });

            updateCountLabel();
        }

        function updatePlayerName(index, value) {
            players[index] = value;
            updateCountLabel();
        }

        function addPlayerInput() {
            players.push('');
            renderPlayerInputs();
        }

        function removePlayer(index) {
            if (players.length > 3) {
                players.splice(index, 1);
                renderPlayerInputs();
            }
        }

        function updateCountLabel() {
            const count = players.filter(p => p.trim() !== '').length;
            const label = document.getElementById('playerCountLabel');
            const btn = document.querySelector('.btn-start');
            
            label.innerText = `${count} jugadores listos`;
            
            if (count >= 3) {
                btn.disabled = false;
                btn.style.opacity = "1";
            } else {
                btn.disabled = true;
                btn.style.opacity = "0.5";
            }
        }

        // --- LÓGICA DEL JUEGO ---

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            // Filtrar nombres vacíos
            activePlayersList = players.filter(p => p.trim() !== '');
            
            if (activePlayersList.length < 3) {
                alert("Necesitas al menos 3 jugadores.");
                return;
            }

            setupRound();
            switchScreen('gameScreen');
            showTurn();
        }

        function setupRound() {
            // Elegir palabra no repetida
            let newWord;
            let attempts = 0;
            do {
                newWord = WORD_DATABASE[Math.floor(Math.random() * WORD_DATABASE.length)];
                attempts++;
            } while (usedWords.includes(newWord) && attempts < 50);

            // Guardar historial
            if (usedWords.length > 20) usedWords.shift();
            usedWords.push(newWord);

            // Asignar variables
            secretWord = newWord;
            impostorIndex = Math.floor(Math.random() * activePlayersList.length);
            currentPlayerIndex = 0;
        }

        // --- PANTALLA DE JUEGO (DISTRIBUCIÓN) ---

        function showTurn() {
            // Resetear vista
            document.getElementById('hiddenCard').classList.remove('d-none');
            document.getElementById('revealedCard').classList.add('d-none');
            
            // Actualizar textos
            document.getElementById('currentTurnLabel').innerText = `${currentPlayerIndex + 1}/${activePlayersList.length}`;
            document.getElementById('playerNameDisplay').innerText = activePlayersList[currentPlayerIndex];
        }

        function revealCard() {
            const isImpostor = currentPlayerIndex === impostorIndex;
            const cardContent = document.getElementById('roleContent');
            
            document.getElementById('hiddenCard').classList.add('d-none');
            document.getElementById('revealedCard').classList.remove('d-none');

            // Limpiar clases anteriores
            cardContent.classList.remove('impostor', 'civilian');

            if (isImpostor) {
                cardContent.classList.add('impostor');
                cardContent.innerHTML = `
                    <i class="fas fa-skull fa-4x text-danger mb-3 animate-pulse"></i>
                    <h2 class="text-danger fw-black ls-2 mb-2">IMPOSTOR</h2>
                    <p class="text-danger-emphasis text-center px-3 small">
                        No sabes la palabra.<br>Escucha a los demás, disimula e intenta adivinarla.
                    </p>
                `;
            } else {
                cardContent.classList.add('civilian');
                cardContent.innerHTML = `
                    <div class="bg-success bg-opacity-25 p-3 rounded-circle mb-3">
                        <i class="fas fa-check fa-2x text-success"></i>
                    </div>
                    <div class="word-reveal text-white mb-2">${secretWord}</div>
                    <p class="text-success-emphasis text-center px-3 small">
                        Esta es la palabra clave.<br>Di algo relacionado sin ser demasiado obvio.
                    </p>
                `;
            }
        }

        function nextPlayer() {
            currentPlayerIndex++;
            if (currentPlayerIndex >= activePlayersList.length) {
                showResults();
            } else {
                showTurn();
            }
        }

        // --- PANTALLA FINAL ---

        function showResults() {
            // CAMBIO: Aseguramos que la selección sea aleatoria en cada ejecución
            const randomIndex = Math.floor(Math.random() * activePlayersList.length);
            const randomStarter = activePlayersList[randomIndex];
            
            document.getElementById('starterName').innerText = randomStarter;
            switchScreen('resultScreen');
        }

        function playAgain() {
            // Misma lista de jugadores, nueva palabra y rol
            setupRound();
            switchScreen('gameScreen');
            showTurn();
        }

        function resetToSetup() {
            switchScreen('setupScreen');
        }

    </script>
</body>
</html>
